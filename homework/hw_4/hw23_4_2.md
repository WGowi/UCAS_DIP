复习理解课本中最佳陷波滤波器进行图像恢复的过程，请推导出$\omega(x,y)$最优解的计算过程，即从公式$\frac{\part\sigma^2(x,y)}{\part\omega(x,y)}=0$到$\omega(x,y)=\frac{\overline{\eta(x,y)g(x,y)}-\overline{g}(x,y)\overline{\eta}(x,y)}{\overline{\eta^2}(x,y)-{\overline{\eta}^2}(x,y)}$的推导过程。



易知
$$
\begin{aligned}
\sigma^2
&=\frac{1}{(2a+1)(2b+1)}\sum_{s=-a}^{a}\sum_{t=-b}^{b}\{[g(x+s,y+t)-\omega(x,y)\cdot\eta(x+s,y+t)]\\
&-[\overline{g(x,y)}-\omega(x,y)\overline{\eta(x,y)}]\}^2\\
&=\frac{1}{(2a+1)(2b+1)}\sum_{s=-a}^{a}\sum_{t=-b}^{b}\{g(x+s,y+t)-\omega(x,y)\cdot\eta(x+s,y+t)\\
&-\overline{g(x,y)}+\omega(x,y)\overline{\eta(x,y)}\}^2\\
&=\frac{1}{(2a+1)(2b+1)}\sum_{s=-a}^{a}\sum_{t=-b}^{b}\{g(x+s,y+t)-\overline{g(x,y)}\\
&+\omega(x,y)[\overline{\eta(x,y)}-\eta(x+s,y+t)]\}^2
\end{aligned}
$$
对$\omega$求导
$$
\begin{aligned}
&\quad\frac{\part \sigma^2(x,y)}{\part \omega(x,y)}\\
&=\frac{2}{(2a+1)(2b+1)}\sum_{s=-a}^{a}\sum_{t=-b}^{b}\{\{g(x+s,y+t)-\overline{g(x,y)}+\omega(x,y)[\overline{\eta(x,y)}-\eta(x+s,y+t)]\}\\
&\cdot[\overline{\eta(x,y)}-\eta(x+s,y+t)]\}\\
&=\frac{2}{(2a+1)(2b+1)}\sum_{s=-a}^{a}\sum_{t=-b}^{b}\{g(x+s,y+t)-\overline{g(x,y)}\cdot[\overline{\eta(x,y)}-\eta(x+s,y+t)]\}\\
&+\frac{2\omega(x,y)}{(2a+1)(2b+1)}\sum_{s=-a}^{a}\sum_{t=-b}^{b}[\overline{\eta(x,y)}-\eta(x+s,y+t)]^2\\
&=\frac{2\overline{\eta(x,y)}}{(2a+1)(2b+1)}\sum_{s=-a}^{a}\sum_{t=-b}^{b}[g(x+s,y+t)-\overline{g(x,y)}]\\
&-\frac{2}{(2a+1)(2b+1)}\sum_{s=-a}^{a}\sum_{t=-b}^{b}\eta(x+s,y+t)[g(x+s,y+t)-\overline{g(x,y)}]\\
&+\frac{2\omega(x,y)}{(2a+1)(2b+1)}\sum_{s=-a}^{a}\sum_{t=-b}^{b}[\overline{\eta(x,y)}^2-2\eta(x+s,y+t)\overline{\eta(x,y)}+\eta^2(x+s,y+t)]\\
&=-\frac{2}{(2a+1)(2b+1)}\sum_{s=-a}^{a}\sum_{t=-b}^{b}\eta(x+s,y+t)[g(x+s,y+t)-\overline{g(x,y)}]\\
&+\frac{2\omega(x,y)}{(2a+1)(2b+1)}\sum_{s=-a}^{a}\sum_{t=-b}^{b}[\overline{\eta(x,y)}^2-2\eta(x+s,y+t)\overline{\eta(x,y)}+\eta^2(x+s,y+t)]\\
&=-2\overline{\eta(x,y)g(x,y)}+2\overline{g(x,y)}\cdot\overline{\eta(x,y)}+2\omega(x,y)[\overline{\eta^2(x,y)}-\overline{\eta(x,y)}^2]\\
&=0
\end{aligned}
$$
所以：
$$
-2\overline{\eta(x,y)g(x,y)}+2\overline{g(x,y)}\cdot\overline{\eta(x,y)}+2\omega(x,y)[\overline{\eta^2(x,y)}-\overline{\eta(x,y)}^2]=0
$$
即：
$$
2\omega(x,y)[\overline{\eta^2(x,y)}-\overline{\eta(x,y)}^2]=2\overline{\eta(x,y)g(x,y)}-2\overline{g(x,y)}\cdot\overline{\eta(x,y)}
$$
可得：
$$
\omega(x,y)=\frac{\overline{\eta(x,y)g(x,y)}-\overline{g(x,y)}\cdot\overline{\eta(x,y)}}{\overline{\eta^2(x,y)}-\overline{\eta(x,y)}^2}
$$
即：
$$
\omega(x,y)=\frac{\overline{\eta(x,y)g(x,y)}-\overline{g}(x,y)\overline{\eta}(x,y)}{\overline{\eta^2}(x,y)-{\overline{\eta}^2}(x,y)}
$$
